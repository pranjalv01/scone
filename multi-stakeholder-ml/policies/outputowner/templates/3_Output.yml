name: $OUTPUT_POLICY_NAME
version: "0.3"

# Access control:
#   - only output owner (CREATOR) can read and update the session
#   - nobody can read the session secrets or delete this session

access_policy:
  read:
   - CREATOR
  update:
   - CREATOR

# Output service iterates over all training results generated by the training and outputs the data

services:
   - name: output
     image_name: output_image
     command: python /app/inference.py /encrypted-output/cifar-model /app/input.png
     mrenclaves: ["$MRENCLAVE_OUTPUT"]
     pwd: /
     fspf_path: /fspf.pb
     fspf_key: "$FSPF_KEY"
     fspf_tag: "$FSPF_TAG"

images:
   - name: output_image
     volumes:
        - name: encrypted_output_volume
          path: /encrypted-output
volumes:
   # No fspf key and tag: an encrypted volume will be automatically generated
   # on the first run
   - name: encrypted_output_volume
     import:
        session: $TRAINING_POLICY_NAME # import encrypted volume to training policy session
        volume: encrypted_output_volume

security:
  attestation:
    tolerate: [debug-mode, hyperthreading, outdated-tcb]
    ignore_advisories: "*"
